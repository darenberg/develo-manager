<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div data-controller="dots">
  <% @project.floors.each do |floor| %>
    <div  id="map-floor<%= floor.number %>" data-maps-target="mapFloors">
      <% floor.plans.each do |plan| %>
        <div class="d-none" id="map-plan-<%= plan.stage %>">
          <% if plan.photo.attached? %>
            <div id="button-container">
              <%= button_to "+", plan_dots_path(plan), method: :post, class:"dot-btn" %>
              <% plan.dots.each do |dot|%>
                <button class="dotbutton text-decoration-none" id="dotbutton<%=dot.id%>" data-dot-id="<%=dot.id%>" data-dot-x=<%= dot.x_position %> data-dot-x=<%= dot.y_position %>>
                  <%= link_to "#{dot.id}", project_path(@project, dot_id: dot.id), class: "text-decoration-none text-white", method: :get, remote: true %>
                </button>
              <% end %>
                <%= cl_image_tag plan.photo.key, height: 550, width: 550, crop: :fill, data: { plan_id: plan.id } %>
            </div>
              <%= simple_form_for [floor,plan], remote: true,  method: :patch do |f| %>
                <%= f.input :photo, as: :file %>
                <%= f.submit %>
              <% end %>
          <% else %>
            <%= simple_form_for [floor,plan], remote: true,  method: :patch do |f| %>
              <%= f.input :photo, as: :file %>
              <%= f.submit %>
          <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
